function getStyle(a,b){var c,d=(a.ownerDocument||document).defaultView;return d&&d.getComputedStyle?(b=b.replace(/([A-Z])/g,"-$1").toLowerCase(),d.getComputedStyle(a,null).getPropertyValue(b)):a.currentStyle?(b=b.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),c=a.currentStyle[b],/^\d+(em|pt|%|ex)?$/i.test(c)?function(b){var c=a.style.left,d=a.runtimeStyle.left;return a.runtimeStyle.left=a.currentStyle.left,a.style.left=b||0,b=a.style.pixelLeft+"px",a.style.left=c,a.runtimeStyle.left=d,b}(c):c):void 0}function getIframeWindow(a){var b;return a.contentWindow?a.contentWindow:a.window?a.window:(!b&&a.contentDocument&&(b=a.contentDocument),!b&&a.document&&(b=a.document),b&&b.defaultView?b.defaultView:b&&b.parentWindow?b.parentWindow:void 0)}function widgetFrameLoaded(a){function b(){var a=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/);return a?parseInt(a[1]):void 0}function c(){return JotForm.validateAll()&&0===$$(".form-line-error").length}function d(a){try{JSON.parse(a)}catch(b){return!1}return!0}function e(a){var b=!1,c=document.getElementById("customFieldFrame_"+a);if(c.hasAttribute("data-type")){var d=c.readAttribute("data-type");"oembed"===d&&(b=!0)}return b}function f(a,c,d){var e=r;void 0!==d&&(e=d);var f=document.getElementById("customFieldFrame_"+c);null!==f&&(-1!=navigator.userAgent.indexOf("Firefox")?XD.postMessage(a,e,getIframeWindow(f)):void 0!==b()?XD.postMessage(a,e,f):XD.postMessage(a,e,getIframeWindow(f)))}function g(){var b=document.getElementById("widget_settings_"+a);return b?b.value:null}function h(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}function i(a){var b=document.getElementById("id_"+a).className;return b.indexOf("jf-required")>-1}function j(a){var b=document.getElementById("customFieldFrame_"+a);return b.hasClassName("frame-ready")||b.retrieve("frame-ready")?!0:!1}function k(a){function b(a,b){$(document.getElementById("customFieldFrame_"+a)).addClassName("frame-ready").store("frame-ready",!0),f(JSON.stringify(b),a)}var c=-1!=navigator.userAgent.indexOf("Firefox")?window.getComputedStyle(document.querySelector(".form-all"),null).getPropertyValue("background-color"):getStyle(document.querySelector(".form-all"),"background"),d=-1!=navigator.userAgent.indexOf("Firefox")?window.getComputedStyle(document.querySelector(".form-all"),null).getPropertyValue("font-family"):getStyle(document.querySelector(".form-all"),"font-family"),e={type:"ready",qid:a+"",formID:document.getElementsByName("formID")[0].value,required:i(a),background:c,fontFamily:d},h=g();h&&"[]"!==decodeURIComponent(h)&&(e.settings=h);var j=document.getElementById("customFieldFrame_"+a),k=j.readAttribute("data-width")||j.style.width,l=j.readAttribute("data-height")||j.style.height;e.width=parseInt(k),e.height=parseInt(l);var n=JotForm.isEditMode()||!!~window.location.href.indexOf("/edit/")||!!~window.location.href.indexOf("inlineEdit");if(n)var o=50,p=5e3,q=0,r=setInterval(function(){(j.hasAttribute("data-value")||q>=p)&&(clearInterval(r),e.value=j.getAttribute("data-value"),m&&console.log("Ready message sent in",q,e),b(a,e)),q+=o},o);else e.value=j.getAttribute("data-value"),m&&console.log("Sending normal ready message",e),b(a,e)}var l=document.getElementById("customFieldFrame_"+a),m=!1,n=void 0==JotForm.forms[0]||"undefined"==typeof JotForm.forms[0]?$($$(".jotform-form")[0].id):JotForm.forms[0];if("62261204289958"===n.id&&(m=!0),!l.hasClassName("custom-field-frame-rendered"))return m&&console.log("Not rendered yet for",a),void 0;if(!e(a)){JCFServerCommon.frames[a]={},JCFServerCommon.frames[a].obj=l;var o=l.src;JCFServerCommon.frames[a].src=o,JCFServerCommon.submitFrames=[];var p=!0,q=!1,r=o;window.sendMessage2Widget=f,window.JCFServerCommon.frames[a].sendReadyMessage=k,XD.receiveMessage(function(e){if(d(e.data)){var g=JSON.parse(e.data);if(m&&console.log("Data from widget",g.qid,g),parseInt(a)===parseInt(g.qid))if("submit"===g.type){if(m&&console.log("widget submit",document.getElementById("input_"+g.qid)),document.getElementById("input_"+g.qid)){"number"==typeof g.value&&(g.value=g.value+"");var i=$(document.getElementById("input_"+g.qid)).hasClassName("widget-required")||$(document.getElementById("input_"+g.qid)).hasClassName("validate[required]"),k=document.getElementById("input_"+g.qid);if(i){var l=JotForm.isVisible(document.getElementById("input_"+g.qid));if(l&&"valid"in g&&(g.valid===!1||g.valid===!0&&!g.value)){m&&console.log("LogA: Setting input value for",g.qid,g),k.setValue("");var n=JotForm.texts.required||"This field is required";"undefined"!=typeof g.error&&g.error!==!1&&(n=g.error.hasOwnProperty("msg")?g.error.msg:n),m&&console.log("Errored required element",k,g),JotForm.errored(k,n)}else l&&!JotForm.isCollapsed(k)&&(m&&console.log("Correcting required element",k,g),JotForm.corrected(k)),j(g.qid)?void 0!==g.value?(k.setValue(g.value),m&&console.log("LogB: Setting input value for",g.qid,g)):(k.setValue(""),m&&console.log("LogC: Setting input value for",g.qid,g)):m&&console.log("LogA: Widget frame not ready, no value set",g.qid,g)}else"undefined"!=typeof g&&("value"in g?j(g.qid)?k.setValue(g.value):m&&console.log("LogB: Widget frame not ready, no value set",g.qid,g):k.hasClassName("widget-static")&&(k.setValue(""),k.removeAttribute("name")));k&&k.up(".form-line")&&k.up(".form-line").hasClassName("form-field-hidden")&&(k.setValue(""),k.removeAttribute("name")),JCFServerCommon.submitFrames.indexOf(parseInt(g.qid))<0&&JCFServerCommon.submitFrames.push(parseInt(g.qid))}for(var o=$$(".widget-required, .widget-errored"),q=!0,r=0;r<o.length;r++)0===o[r].value.length&&JotForm.isVisible(o[r])&&(q=!1);if(!p)if(m&&console.log("next page",p,c(),q),c()&&q){m&&console.log("sendSubmit",p,q);var s=void 0==JotForm.forms[0]||"undefined"==typeof JotForm.forms[0]?$($$(".jotform-form")[0].id):JotForm.forms[0],t=!!~window.location.href.indexOf("/edit/")||window.location.search.match("inlineEdit|edit"),u=["stripe","braintree","square"];JotForm.payment&&u.indexOf(JotForm.payment)>-1&&JotForm.isPaymentSelected()&&JotForm.paymentTotal>0&&!t||($$('.custom-field-frame[data-type="iframe"]').length===JCFServerCommon.submitFrames.length?(m&&console.log("All frames submitted",JCFServerCommon.submitFrames),_submitLast.submit(s,50)):m&&console.log("Not all frames submitted",JCFServerCommon.submitFrames))}else JotForm.enableButtons(),JotForm.showButtonMessage()}else if("data"===g.type){var v=document.getElementById("input_"+g.qid);v.value=g.value,v.triggerEvent("change"),JotForm.triggerWidgetCondition(g.qid),JotForm.triggerWidgetCalculation(g.qid)}else if("errors"===g.type){var w=document.getElementById("input_"+g.qid);"show"===g.action?JotForm.isVisible(w)&&(JotForm.corrected(w),w.value="",w.addClassName("widget-errored"),JotForm.errored(w,g.msg),"resetForm"in g&&g.resetForm===!0&&JotForm.enableButtons()):"hide"===g.action&&(w.removeClassName("widget-errored"),JotForm.corrected(w))}else if("required"===g.type){var w=document.getElementById("input_"+g.qid);"set"!==g.action||w.hasClassName("widget-required")?"unset"===g.action&&(w.removeClassName("widget-required"),JotForm.corrected(w)):w.addClassName("widget-required")}else if("size"===g.type){var x=g.width,y=g.height;void 0!==x&&null!==x&&(0===x||"0"===x?x="auto":x+="px",document.getElementById("customFieldFrame_"+g.qid).style.width=x),void 0!==y&&null!==y&&(document.getElementById("customFieldFrame_"+g.qid).style.height=y+"px",void 0!==b()&&(document.getElementById("cid_"+g.qid).style.height=y+"px")),JotForm.iframeHeightCaller()}else if("replace"===g.type){var z=g.inputType,A=g.isMobile,B=g.required,C=$("customFieldFrame_"+g.qid).up(),D=$("input_"+g.qid).readAttribute("name");$("customFieldFrame_"+g.qid).remove(),$("input_"+g.qid).up().remove();var E="",F=B?"validate[required] widget-required widget-replaced":"";switch(z){case"control_fileupload":var s=void 0==JotForm.forms[0]||"undefined"==typeof JotForm.forms[0]?$($$(".jotform-form")[0].id):JotForm.forms[0];s.setAttribute("enctype","multipart/form-data"),A||(F=""===F?"validate[upload]":F,E='<input class="form-upload '+F+'" type="file" id="input_'+g.qid+'" name="'+D+'" file-accept="pdf, doc, docx, xls, xlsx, csv, txt, rtf, html, zip, mp3, wma, mpg, flv, avi, jpg, jpeg, png, gif"'+'file-maxsize="10240">'),C.insert(E);break;case"control_textbox":E='<input class="form-textbox '+F+'" type="text" data-type-"input-textbox" id="input_'+g.qid+'" name="'+D+'">',C.insert(E);break;case"control_textarea":E='<textarea class="form-textarea '+F+'" type="text" id="input_'+g.qid+'" name="'+D+'" cols="40" rows="6"></textarea>',C.insert(E)}}else if("event:listener"===g.type){var G=document.getElementById(g.field);if(G&&["keyup","change"].indexOf(g.event)>-1){m&&console.log("Event registered from ",g.qid);var H=function(a){var b=a.target.value;b="undefined"!=typeof b?b:"",m&&console.log("Handler for ",g.qid,"triggered",b,a.target.id),a.target.id===g.field&&(m&&console.log("event:receiver: Sending message to ",g.qid,"with value",b),f(JSON.stringify({eventID:g.eventID,type:"event:receiver",value:b}),g.qid))};Event.observe(G,g.event,"keyup"===g.event?h(H,100):H)}}else if("event:store"===g.type){var G=document.getElementById(g.field);if(G){var I=$(g.field).up(".form-line").id.split("_")[1],J={eventID:g.eventID,type:"event:receiver",value:g.value};"widget"===JotForm.getInputType(I)||"isWidget"in g&&g.isWidget?(window.console&&"warn"in console&&console.warn("Sending value to destination(widget) from a source(widget) is not recommended."),delete J.eventID,J.field=g.field,J.isWidget=!0,J.targetQID=I,m&&console.log("Sending data to widget field",I,J),f(JSON.stringify(J),I)):(G.setValue(g.value),"hasCallback"in g&&g.hasCallback&&(m&&console.log("Sending data to native field",g),f(JSON.stringify(J),g.qid)))}}}},l.src.replace(/([^:]+:\/\/[^\/]+).*/,"$1")),m&&console.log("sending settings",g(),(new Date).getTime()),f(JSON.stringify({type:"settings",settings:g()}),a),m&&console.log("sending form strings",JotForm.texts,(new Date).getTime()),f(JSON.stringify({type:"formstrings",formTexts:JotForm.texts}),a);var s=JotForm.getSection(l);l&&JotForm.isVisible(s)&&JotForm.isVisible(l)&&"undefined"==typeof l.up(".form-section-closed")&&k(a),Event.observe(n,"submit",function(b){null!==document.getElementById("customFieldFrame_"+a)&&(Event.stop(b),p=!1,m&&console.log("Form stopped from widget server event, submitting form from widge submit event"),f(JSON.stringify({type:"submit",qid:a+""}),a+""))}),$$(".form-pagebreak-next").each(function(b){$(b).observe("click",function(b){q=this.up(".form-section"),p=!0,q.select("#customFieldFrame_"+a).length>0&&(m&&console.log("Sending submit message for iframe id",a,"from section",this.up(".form-section"),"and iframe",l),f(JSON.stringify({type:"submit",qid:a+""}),a+""),Event.stop(b));var c=setInterval(function(){l=document.getElementById("customFieldFrame_"+a),l?(q=$(l).up(".form-section"),JotForm.isVisible(q)&&JotForm.isVisible(l)?(clearInterval(c),m&&console.log("Sending ready message for iframe id",a,"from section",q),k(a)):(m&&console.log("Section and frameObj not visible",q,l),clearInterval(c))):clearInterval(c)},100)})}),$("input_"+a)&&$("input_"+a).observe("widget:clear",function(a){var b=a.memo.qid;f(JSON.stringify({type:"widgetclear",qid:b}),b)})}}if("object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),window.console||(console={log:function(){}}),void 0===window.getStyle,void 0===window.getIframeWindow,"undefined"==typeof XD)var XD=function(){var a,b,c,d=1,e=this;return{postMessage:function(a,b,c){b&&(c=c||parent,e.postMessage?("postMessage"in c||(c=getIframeWindow(c)),c.postMessage(a,b.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))):b&&(c.location=b.replace(/#.*$/,"")+"#"+ +new Date+d++ +"&"+a))},receiveMessage:function(d,f){e.postMessage?(d&&(c=function(a){return"string"==typeof f&&a.origin!==f||"[object Function]"===Object.prototype.toString.call(f)&&f(a.origin)===!1?!1:(d(a),void 0)}),e.addEventListener?e[d?"addEventListener":"removeEventListener"]("message",c,!1):e[d?"attachEvent":"detachEvent"]("onmessage",c)):(a&&clearInterval(a),a=null,d&&(a=setInterval(function(){var a=document.location.hash,c=/^#?\d+&/;a!==b&&c.test(a)&&(b=a,d({data:a.replace(c,"")}))},100)))}}}();void 0===window.JCFServerCommon&&(window.JCFServerCommon={frames:{},func:{}});var _submitLast={t:null,submitted:!1,submit:function(a,b){this.submitted!==!0&&(null!==this.t&&clearTimeout(this.t),this.t=setTimeout(function(){this.submitted=!0,a.submit(),JotForm.disableButtons()},b))}};
//# sourceMappingURL=js-sdk/sourcemap/WidgetsServer.js.map